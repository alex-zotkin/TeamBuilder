<link href="~/css/marks.css" rel="stylesheet" />

<div id="app" v-cloak>
    <div class="info_for_admin" v-if="data.Project.IsMarksOpen && data.IsUserAdmin">
        <p>
            Оценки <b>ВИДНЫ</b> всем студентам
            <br><em>Имена членов жюри, ставивших <br>соответсвуюущие оценки, по преженему скрыты</em>
        </p> 
        <input type="button" name="name" value="Скрыть результаты" class="button button_red" v-on:click="marksOpen('close')"/>
    </div>
    <div class="info_for_admin" v-else-if="!data.Project.IsMarksOpen && data.IsUserAdmin">
        <p>Оценки <b>СКРЫТЫ</b> от студентов</p>
        <input type="button" name="name" value="Открыть результаты" class="button button_green" v-on:click="marksOpen('open')"/>
    </div>

    <table v-if="(data.Project.IsMarksOpen && !data.IsUserAdmin && !data.IsUserJury) || data.IsUserAdmin || data.IsUserJury">
        <tr>
            <th>#</th>
            <th>Команда, тип</th>
            <th>Описание</th>
            <th>Участники</th>
            <th v-for="mark in data.Teams[0].Marks">{{mark[0].Name}} <mark><em>max = {{mark[0].MaxPoints}}</em></mark><br> <b></b> </th>
            <th>Итоговая оценка</th>
        </tr>
        <tr v-for="(item, index) in data.Teams" :key="index">
            <td width="25">{{index + 1}}</td>
            <td width="10%">
                <a :href="'/project/' + item.Team.ProjectId + '/team/' + item.Team.TeamId"><h3>{{item.Team.Title}}</h3></a>
                <p>{{item.Team.Type}}</p>
            </td>
            <td width="25%">
                {{item.Team.Description}}
            </td>
            <td width="10%">
                <ul class="users">
                    <li v-for="user in item.Users">
                        <a :href="'https://vk.com/id' + user.VkId"><img :src="user.Photo50" :title="user.FirstName + ' ' + user.LastName" style="width: 40px; height: 40px; border-radius: 99px;"></a>
                    </li>
                </ul>
            </td>
            <td v-for="(stage, i) in item.Marks" :key="i">
                <div class="mark_box" v-for="mark in stage">
                    <div v-if="data.IsUserAdmin || data.IsUserJury">
                        <label v-if="activeInput(mark.User.UserId)" style="color: green"><b>{{mark.User.FirstName}} {{mark.User.LastName}}</b> &nbsp; &nbsp; </label>
                        <label v-else>{{mark.User.FirstName}} {{mark.User.LastName}} &nbsp; &nbsp; </label>
                    </div>
                    <div v-else>
                        <label>Оценка {{index + 1}} &nbsp; &nbsp; </label>
                    </div>

                    <input v-if="activeInput(mark.User.UserId)" type="number" :value="mark.Points" min="0" :max="mark.MaxPoints" v-on:input="setMark(item.Team.TeamId, $event.target, mark.Name)" />
                    <input v-else type="number" :value="mark.Points" min="0" :max="mark.MaxPoints" disabled />
                </div>
                <p>Сумарно: <b>{{data.StageSum[i]}}/{{stage[0].MaxPoints}}</b></p>
            </td>
            <td width="10%">
                <h2>{{data.Summary}}</h2>
            </td>
        </tr>
    </table>
    <div v-else style="display: flex; width: 100%; justify-content: center; height: 600px; align-items:center; flex-direction:column;">
        <h2><em>Оценки скрыты администратором</em></h2><br>
        <a :href="'/project/' + data.Project.ProjectId">Вернуться в проектную деятельность</a>
    </div>
</div>

<script src="~/js/marks.js"></script>
